# MongoDB SSL/TLS Encryption - Securing Data in Transit

## Overview

**Purpose**: Encrypt data transmitted between MongoDB client applications and the MongoDB server to prevent unauthorized access during data transfer.

**Key Concept**: While MongoDB can be secured with user authentication and authorization, data traveling between the client and server also needs protection through encryption.

## What is SSL/TLS?

- **SSL (Secure Sockets Layer)** / **TLS (Transport Layer Security)**
- TLS is the successor to SSL, but the terms are often used interchangeably
- Uses public-private key pairs for encryption/decryption
- Ensures data remains encrypted throughout transit
- Provides authentication to verify client and server identities

## Typical MongoDB Application Architecture

```
[Application] ←→ [MongoDB Driver] ←→ [MongoDB Server]
   (Node.js,        (Encrypted         (Database)
   PHP, Python,      Connection)
   C++, etc.)
```

## Setting Up SSL/TLS Encryption

### Step 1: Generate SSL Certificates

**Command to generate certificates** (works on Linux/Mac):

```bash
openssl req -newkey rsa:2048 -new -x509 -days 3653 -nodes -out mongodb-cert.crt -keyout mongodb-cert.key
```

**For Windows users**:

1.  Download OpenSSL from the official binaries wiki
2.  Install the Win64 OpenSSL Light version
3.  Navigate to the installation's `bin` folder in command prompt
4.  Run the same OpenSSL command

### Step 2: Certificate Generation Process

**Interactive prompts**:

- Most fields can be filled with dots (.) or any information
- **CRITICAL**: Common Name field must be `localhost` for development
- For production: Use the actual server domain/IP address
- Email address can be any valid email
  **Why Common Name matters**: MongoDB validates that the server you're connecting to matches the certificate's Common Name. Mismatch will cause connection failures.

### Step 3: Combine Certificate Files

After generation, you'll have two files:

- `mongodb-cert.key` (private key)
- `mongodb-cert.crt` (certificate)
  **Combine them into a single PEM file**:

Linux/Mac:

```bash
cat mongodb-cert.key mongodb-cert.crt > mongodb.pem
```

Windows:

```cmd
type mongodb-cert.key mongodb-cert.crt > mongodb.pem
```

## MongoDB Server SSL Configuration

### SSL Mode Options

| Mode         | Description                             |
| ------------ | --------------------------------------- |
| `disabled`   | No SSL encryption (default)             |
| `allowSSL`   | Clients can connect with or without SSL |
| `preferSSL`  | SSL preferred (mainly for replica sets) |
| `requireSSL` | All connections must use SSL            |

### Starting MongoDB with SSL

**Basic SSL startup command**:

```bash
mongod --sslMode requireSSL --sslPEMKeyFile mongodb.pem
```

**With sudo (if needed on Mac/Linux)**:

```bash
sudo mongod --sslMode requireSSL --sslPEMKeyFile /path/to/mongodb.pem
```

### Additional SSL Options

- `--sslCAFile`: Certificate Authority file (for production use)
- `--sslPEMKeyPassword`: If PEM file is password-protected

## Production Considerations

### Certificate Authority (CA) Files

**Development**: Self-signed certificates (what we created)

- No CA file needed
- Warning message about missing SSL certificate validation
- Suitable for development/testing
  **Production**: Certificates from official Certificate Authorities

- Provides CA file in addition to PEM file
- Prevents man-in-the-middle attacks
- Both free and paid options available
- Use both `--sslPEMKeyFile` and `--sslCAFile` arguments

## Client Connection with SSL

### MongoDB Shell Connection

**Basic SSL connection**:

```bash
mongo --ssl --sslCAFile mongodb.pem --host localhost
```

### Why specify --host localhost?

- Without explicit host, client connects to IP `127.0.0.1`
- Certificate was created for `localhost`
- `127.0.0.1` ≠ `localhost` in certificate validation
- Explicit host specification ensures certificate validation passes

### Connection Troubleshooting

**Common issues**:

1.  **Certificate name mismatch**: Ensure host matches certificate Common Name
2.  **File path errors**: Verify PEM file location and permissions
3.  **Port conflicts**: Check if multiple MongoDB instances are running

## Application Driver Configuration

When connecting from applications (Node.js, Python, etc.), drivers typically support SSL options:

**Example connection patterns**:

- Enable SSL in connection string or driver options
- Specify certificate files if using custom certificates
- Configure certificate validation settings

## Security Benefits

### What SSL/TLS Protects Against

1.  **Data interception**: Encrypted data cannot be read during transit
2.  **Man-in-the-middle attacks**: Certificate validation prevents impersonation
3.  **Data tampering**: Encryption ensures data integrity

### What It Doesn't Protect

- Data at rest (needs separate encryption)
- Unauthorized database access (needs authentication/authorization)
- Application-level security vulnerabilities

## Best Practices Summary

### Development

- Use self-signed certificates for testing
- Set Common Name to `localhost`
- Use `requireSSL` mode to enforce encryption

### Production

- Obtain certificates from trusted Certificate Authorities
- Use proper domain names in certificates
- Implement certificate rotation policies
- Monitor certificate expiration dates
- Use strong cipher suites

### Monitoring and Maintenance

- Regularly update certificates before expiration
- Monitor SSL connection logs
- Test SSL configuration after updates
- Document certificate management procedures

## Key Takeaways

1.  **SSL/TLS is essential** for securing data in transit between MongoDB clients and servers
2.  **Certificate Common Name must match** the hostname used for connections
3.  **Self-signed certificates work for development** but production requires CA-signed certificates
4.  **Both server and client must be configured** for SSL to work properly
5.  **SSL mode 'requireSSL'** ensures all connections are encrypted
6.  **Proper certificate management** is crucial for maintaining security over time
